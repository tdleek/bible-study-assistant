<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GospelPath ‚Äì AI-Powered Bible Study Assistant</title>
    
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js for interactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Google Fonts: Playfair Display SC, Lora, Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display+SC:wght@400;700;900&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Dark mode color palette */
        :root {
            --charcoal: #0B1118;
            --midnight-card: #112240;
            --moonlit-silver: #C0C5D9;
            --silver-glow: #E8ECF4;
            --ivory-text: #F5F5F0;
            --deep-blue: #1A2B4A;
            --soft-silver: #9BA4B8;
        }
        
        /* Font families */
        .font-playfair { font-family: 'Playfair Display SC', serif; }
        .font-lora { font-family: 'Lora', serif; }
        .font-inter { font-family: 'Inter', sans-serif; }
        
        /* Hero gradient background - Gethsemane night theme */
        .hero-gradient-dark {
            background: linear-gradient(180deg, 
                #0B1118 0%, 
                #1A2B4A 50%, 
                #112240 100%
            );
            position: relative;
        }
        
        /* Subtle texture overlay */
        .hero-gradient-dark::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 600"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.05"/></svg>');
            opacity: 0.08;
            pointer-events: none;
        }
        
        /* Moonlit silver path animation */
        @keyframes pathGlowMoon {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(192, 197, 217, 0.5)); }
            50% { filter: drop-shadow(0 0 35px rgba(232, 236, 244, 0.8)); }
        }
        
        @keyframes pathDraw {
            from { stroke-dashoffset: 2000; }
            to { stroke-dashoffset: 0; }
        }
        
        @keyframes crossGlowMoon {
            0%, 100% { opacity: 0.8; filter: drop-shadow(0 0 18px rgba(232, 236, 244, 0.7)); }
            50% { opacity: 1; filter: drop-shadow(0 0 35px rgba(232, 236, 244, 1)); }
        }
        
        .moonlit-path {
            animation: pathGlowMoon 4s ease-in-out infinite;
        }
        
        .path-line {
            stroke-dasharray: 2000;
            stroke-dashoffset: 2000;
            animation: pathDraw 3s ease-out forwards;
        }
        
        .cross-glow-moon {
            animation: crossGlowMoon 3s ease-in-out infinite;
        }
        
        /* Dark mode input styling */
        .parchment-input-dark {
            background: rgba(17, 34, 64, 0.95);
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.3),
                0 10px 25px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(192, 197, 217, 0.1);
            transition: all 0.3s ease;
            color: var(--ivory-text);
        }
        
        .parchment-input-dark::placeholder {
            color: rgba(155, 164, 184, 0.6);
        }
        
        .parchment-input-dark:focus {
            outline: none;
            box-shadow: 
                0 6px 12px rgba(0, 0, 0, 0.4),
                0 15px 35px rgba(0, 0, 0, 0.3),
                inset 0 0 0 2px rgba(192, 197, 217, 0.4),
                0 0 25px rgba(192, 197, 217, 0.3);
            background: rgba(17, 34, 64, 1);
        }
        
        /* Scripture card entrance animation */
        @keyframes cardEntrance {
            from { 
                opacity: 0; 
                transform: translateY(20px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }
        
        .scripture-card {
            animation: cardEntrance 0.8s ease-out forwards;
        }
        
        /* Mobile path adjustments */
        @media (max-width: 768px) {
            .moonlit-path-svg {
                width: 120px !important;
                height: 70vh !important;
            }
        }
        
        /* Letter spacing for logo */
        .logo-spacing {
            letter-spacing: 0.15em;
        }
        
        /* Small caps effect */
        .small-caps {
            font-variant: small-caps;
            letter-spacing: 0.08em;
        }
        
        /* Loading spinner */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .spinner {
            animation: spin 1s linear infinite;
        }
        
        /* Typing indicator */
        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        .typing-dot {
            animation: pulse 1.4s ease-in-out infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    </style>
</head>
<body class="font-inter antialiased bg-[#0B1118]" x-data="bibleApp()">
    
    <!-- Navigation -->
    <nav 
        x-show="showNav" 
        x-transition
        class="fixed top-0 left-0 right-0 z-50 backdrop-blur-sm"
    >
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 bg-[#112240]/90 border-b border-[#C0C5D9]/20">
            <div class="flex items-center justify-between">
                <div class="font-playfair text-xl md:text-2xl text-[#C0C5D9] logo-spacing cursor-pointer" @click="resetView()">
                    GospelPath
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Translation Selector -->
                    <select 
                        x-model="selectedTranslation"
                        class="bg-[#112240] text-[#F5F5F0] border border-[#C0C5D9]/30 rounded-lg px-3 py-2 text-sm font-inter focus:border-[#C0C5D9] focus:outline-none"
                    >
                        <option value="ESV">ESV</option>
                        <option value="NIV">NIV</option>
                        <option value="KJV">KJV</option>
                        <option value="NKJV">NKJV</option>
                        <option value="NASB">NASB</option>
                        <option value="NLT">NLT</option>
                        <option value="CSB">CSB</option>
                        <option value="MSG">MSG</option>
                        <option value="AMP">AMP</option>
                        <option value="NRSV">NRSV</option>
                    </select>
                    
                    <!-- API Key Status -->
                    <button 
                        @click="showSettings = !showSettings"
                        class="w-10 h-10 rounded-full bg-[#C0C5D9]/10 hover:bg-[#C0C5D9]/20 transition-colors flex items-center justify-center"
                        :title="apiKey ? 'API Connected' : 'Set API Key'"
                    >
                        <span x-show="apiKey">‚öôÔ∏è</span>
                        <span x-show="!apiKey">üîë</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Settings Modal -->
    <div 
        x-show="showSettings" 
        x-transition
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm px-4"
        @click.self="showSettings = false"
    >
        <div class="bg-[#112240] rounded-2xl p-8 max-w-md w-full border border-[#C0C5D9]/30 shadow-2xl">
            <h2 class="font-playfair text-2xl text-[#C0C5D9] mb-4">API Settings</h2>
            <p class="font-lora text-sm text-[#9BA4B8] mb-6">
                Enter your Groq API key to enable AI-powered Bible study assistance. Get a free key at 
                <a href="https://console.groq.com" target="_blank" class="text-[#C0C5D9] hover:underline">console.groq.com</a>
            </p>
            <input 
                type="password"
                x-model="tempApiKey"
                placeholder="gsk_..."
                class="w-full bg-[#0B1118] text-[#F5F5F0] border border-[#C0C5D9]/30 rounded-lg px-4 py-3 mb-4 font-mono text-sm focus:border-[#C0C5D9] focus:outline-none"
            >
            <div class="flex gap-3">
                <button 
                    @click="saveApiKey()"
                    class="flex-1 bg-[#C0C5D9] text-[#0B1118] font-inter font-semibold py-3 rounded-lg hover:bg-[#E8ECF4] transition-colors"
                >
                    Save
                </button>
                <button 
                    @click="showSettings = false"
                    class="flex-1 bg-[#112240] text-[#F5F5F0] border border-[#C0C5D9]/30 font-inter font-semibold py-3 rounded-lg hover:bg-[#1A2B4A] transition-colors"
                >
                    Cancel
                </button>
            </div>
        </div>
    </div>
    
    <!-- Hero Section -->
    <section 
        x-show="!hasSearched"
        x-transition
        class="hero-gradient-dark min-h-screen flex flex-col items-center justify-center relative overflow-hidden px-4 sm:px-6"
    >
        <!-- Moonlit Silver Path SVG -->
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <svg 
                class="moonlit-path-svg" 
                width="200" 
                height="80vh" 
                viewBox="0 0 200 800" 
                xmlns="http://www.w3.org/2000/svg"
            >
                <path 
                    class="path-line moonlit-path"
                    d="M 100 800 Q 60 700, 100 600 Q 140 500, 100 400 Q 60 300, 100 200 L 100 120"
                    fill="none" 
                    stroke="#C0C5D9" 
                    stroke-width="3"
                    stroke-linecap="round"
                    opacity="0.8"
                />
                <g class="cross-glow-moon" transform="translate(100, 80)">
                    <line x1="0" y1="-30" x2="0" y2="30" stroke="#E8ECF4" stroke-width="5" stroke-linecap="round"/>
                    <line x1="-20" y1="0" x2="20" y2="0" stroke="#E8ECF4" stroke-width="5" stroke-linecap="round"/>
                    <circle cx="0" cy="0" r="25" fill="rgba(232, 236, 244, 0.15)"/>
                    <circle cx="0" cy="0" r="15" fill="rgba(232, 236, 244, 0.25)"/>
                </g>
            </svg>
        </div>
        
        <!-- Content -->
        <div class="relative z-10 text-center max-w-4xl mx-auto space-y-8">
            <h1 class="font-playfair text-4xl sm:text-5xl md:text-7xl text-[#C0C5D9] logo-spacing font-bold">
                GospelPath
            </h1>
            <h2 class="font-lora text-lg sm:text-xl md:text-2xl text-[#F5F5F0] font-medium">
                Your AI-Powered Journey Through Scripture
            </h2>
            <p class="font-lora text-base md:text-lg text-[#9BA4B8] italic">
                Walk the Word. Ask anything.
            </p>
            
            <!-- Search Input -->
            <div class="mt-12 max-w-2xl mx-auto">
                <input 
                    type="text"
                    x-model="userQuery"
                    @keydown.enter="handleSearch()"
                    @focus="showNav = true"
                    placeholder="Ask about any verse, topic, or biblical question..."
                    class="parchment-input-dark w-full px-6 sm:px-8 md:px-10 py-4 sm:py-5 md:py-6 rounded-2xl font-lora text-base sm:text-lg md:text-xl border-t-2 border-[#C0C5D9]/30"
                />
                <button 
                    @click="handleSearch()"
                    :disabled="!userQuery || loading"
                    class="mt-4 px-8 py-3 bg-[#C0C5D9] text-[#0B1118] font-inter font-semibold rounded-lg hover:bg-[#E8ECF4] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    Search Scripture
                </button>
            </div>
        </div>
    </section>
    
    <!-- Results Section -->
    <section 
        x-show="hasSearched" 
        x-transition
        class="min-h-screen py-20 px-4 sm:px-6 bg-gradient-to-b from-[#112240] to-[#0B1118]"
        :class="{ 'pt-28': showNav }"
    >
        <div class="max-w-4xl mx-auto">
            
            <!-- Back to Search -->
            <button 
                @click="resetView()"
                class="mb-8 flex items-center gap-2 text-[#C0C5D9] hover:text-[#E8ECF4] transition-colors font-inter"
            >
                <span>‚Üê</span> New Search
            </button>
            
            <!-- User Query Display -->
            <div class="mb-8 bg-[#112240]/60 rounded-lg p-6 border-l-4 border-[#C0C5D9]">
                <p class="font-lora text-lg text-[#F5F5F0]" x-text="userQuery"></p>
            </div>
            
            <!-- Loading State -->
            <div x-show="loading" class="flex flex-col items-center justify-center py-20">
                <div class="w-16 h-16 border-4 border-[#C0C5D9]/30 border-t-[#C0C5D9] rounded-full spinner"></div>
                <p class="mt-6 font-lora text-[#9BA4B8] text-lg">Searching the Scriptures...</p>
                <div class="flex gap-2 mt-4">
                    <span class="w-2 h-2 bg-[#C0C5D9] rounded-full typing-dot"></span>
                    <span class="w-2 h-2 bg-[#C0C5D9] rounded-full typing-dot"></span>
                    <span class="w-2 h-2 bg-[#C0C5D9] rounded-full typing-dot"></span>
                </div>
            </div>
            
            <!-- Error Message -->
            <div x-show="errorMessage" class="bg-red-900/20 border border-red-500/50 rounded-lg p-6 mb-8">
                <p class="font-lora text-red-300" x-text="errorMessage"></p>
            </div>
            
            <!-- AI Response -->
            <div x-show="aiResponse && !loading" class="space-y-8">
                <article class="scripture-card bg-gradient-to-br from-[#C0C5D9]/10 to-[#9BA4B8]/10 backdrop-blur-sm rounded-lg p-6 sm:p-8 md:p-10 border-l-4 border-[#C0C5D9] shadow-xl">
                    <h3 class="font-playfair text-2xl text-[#E8ECF4] mb-4 flex items-center gap-2">
                        <span>‚ú®</span> AI Insight
                    </h3>
                    <div class="font-lora text-base sm:text-lg leading-relaxed text-[#F5F5F0]/90 prose prose-invert" x-html="formatResponse(aiResponse)"></div>
                </article>
                
                <!-- Conversation History -->
                <template x-for="(msg, index) in conversationHistory" :key="index">
                    <div x-show="index > 0">
                        <div x-show="msg.role === 'user'" class="bg-[#112240]/60 rounded-lg p-4 sm:p-6 mb-4">
                            <p class="font-inter text-sm text-[#9BA4B8] mb-2">You asked:</p>
                            <p class="font-lora text-base sm:text-lg text-[#F5F5F0]" x-text="msg.content"></p>
                        </div>
                        <div x-show="msg.role === 'assistant'" class="scripture-card bg-[#112240]/95 backdrop-blur-sm rounded-lg p-6 sm:p-8 border-t-2 border-[#C0C5D9]/40 shadow-xl mb-8">
                            <div class="font-lora text-base sm:text-lg leading-relaxed text-[#F5F5F0]/90 prose prose-invert" x-html="formatResponse(msg.content)"></div>
                        </div>
                    </div>
                </template>
                
                <!-- Follow-up Question -->
                <div class="bg-[#112240]/60 rounded-lg p-6 border border-[#C0C5D9]/30">
                    <label class="font-inter text-sm text-[#9BA4B8] mb-3 block">Ask a follow-up question:</label>
                    <div class="flex gap-3">
                        <input 
                            type="text"
                            x-model="followUpQuery"
                            @keydown.enter="askFollowUp()"
                            placeholder="Continue the conversation..."
                            class="flex-1 bg-[#0B1118] text-[#F5F5F0] border border-[#C0C5D9]/30 rounded-lg px-4 py-3 font-lora focus:border-[#C0C5D9] focus:outline-none"
                        />
                        <button 
                            @click="askFollowUp()"
                            :disabled="!followUpQuery || loading"
                            class="px-6 py-3 bg-[#C0C5D9] text-[#0B1118] font-inter font-semibold rounded-lg hover:bg-[#E8ECF4] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            Send
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <script>
        function bibleApp() {
            return {
                // State
                showNav: false,
                showSettings: false,
                hasSearched: false,
                loading: false,
                userQuery: '',
                followUpQuery: '',
                aiResponse: '',
                errorMessage: '',
                selectedTranslation: 'NIV',
                apiKey: localStorage.getItem('groqApiKey') || '',
                tempApiKey: '',
                conversationHistory: [], // For maintaining context
                
                // Initialize
                init() {
                    // Show nav after 8 seconds if no interaction
                    setTimeout(() => {
                        if (!this.hasSearched) this.showNav = true;
                    }, 8000);
                },
                
                // Save API key to localStorage
                saveApiKey() {
                    if (this.tempApiKey.trim()) {
                        this.apiKey = this.tempApiKey.trim();
                        localStorage.setItem('groqApiKey', this.apiKey);
                        this.showSettings = false;
                        this.tempApiKey = '';
                        alert('API key saved successfully!');
                    }
                },
                
                // Handle main search
                async handleSearch() {
                    if (!this.userQuery.trim()) return;
                    
                    if (!this.apiKey) {
                        this.errorMessage = 'Please set your Groq API key in the settings (‚öôÔ∏è) to use AI features.';
                        this.showSettings = true;
                        return;
                    }
                    
                    this.hasSearched = true;
                    this.loading = true;
                    this.errorMessage = '';
                    this.showNav = true;
                    
                    // Initialize conversation with system prompt
                    this.conversationHistory = [{
                        role: 'system',
                        content: `You are a knowledgeable and reverent Bible study assistant. Help users understand Scripture with accuracy, context, and spiritual insight. When referencing verses, use the ${this.selectedTranslation} translation when possible. Provide thoughtful explanations that honor the text and help users grow in their faith. Format your responses with clear paragraphs.`
                    }, {
                        role: 'user',
                        content: this.userQuery
                    }];
                    
                    await this.callGroqAPI();
                },
                
                // Handle follow-up questions
                async askFollowUp() {
                    if (!this.followUpQuery.trim()) return;
                    
                    this.loading = true;
                    this.errorMessage = '';
                    
                    // Add user's follow-up to conversation
                    this.conversationHistory.push({
                        role: 'user',
                        content: this.followUpQuery
                    });
                    
                    // Clear the input
                    this.followUpQuery = '';
                    
                    await this.callGroqAPI();
                },
                
                // Call Groq API with conversation history
                async callGroqAPI() {
                    try {
                        const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.apiKey}`
                            },
                            body: JSON.stringify({
                                model: 'llama-3.3-70b-versatile', // Updated model
                                messages: this.conversationHistory,
                                temperature: 0.7,
                                max_tokens: 2000
                            })
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error?.message || 'API request failed');
                        }
                        
                        const data = await response.json();
                        const assistantMessage = data.choices[0].message.content;
                        
                        // Add assistant response to conversation history
                        this.conversationHistory.push({
                            role: 'assistant',
                            content: assistantMessage
                        });
                        
                        this.aiResponse = assistantMessage;
                        this.loading = false;
                        
                    } catch (error) {
                        console.error('Error calling Groq API:', error);
                        this.errorMessage = `Error: ${error.message}. Please check your API key and try again.`;
                        this.loading = false;
                    }
                },
                
                // Format response with basic markdown-like rendering
                formatResponse(text) {
                    if (!text) return '';
                    
                    return text
                        .split('\n\n')
                        .map(paragraph => `<p class="mb-4">${paragraph.trim()}</p>`)
                        .join('')
                        .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                        .replace(/\*([^*]+)\*/g, '<em>$1</em>');
                },
                
                // Reset to initial view
                resetView() {
                    this.hasSearched = false;
                    this.userQuery = '';
                    this.aiResponse = '';
                    this.errorMessage = '';
                    this.conversationHistory = [];
                }
            }
        }
    </script>
</body>
</html>
